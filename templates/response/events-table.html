<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">

<div class="col-md-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Event List</h3>
            <div class="actions pull-right">
                <i class="fa fa-expand"></i>
                <i class="fa fa-chevron-down"></i>
                <i class="fa fa-times"></i>
            </div>
        </div>
        <div class="panel-body">
            <table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
                <thead>
                <tr>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Content</th>
{#                    <th>Detail</th>#}
                </tr>
                </thead>
                <tbody id="event_table">
                <tr>
                    <td>Tiger Nixon</td>
                    <td>System Architect</td>
                    <td>Edinburgh</td>
{#                    <td>#}
{#                        <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#scrollingModal">#}
{#                            detail#}
{#                        </button>#}
{#                    </td>#}
                </tr>

                </tbody>
            </table>
        </div>
    </div>
</div>
<div class="col-md-12">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">Create a event</h3>
            <div class="actions pull-right">
                <i class="fa fa-expand"></i>
                <i class="fa fa-chevron-down"></i>
                <i class="fa fa-times"></i>
            </div>
        </div>
        <div class="panel-body">
            <form class="form-horizontal form-border">
                <div class="form-group">
                    <label class="col-sm-3 control-label">Event title</label>
                    <div class="col-sm-6">
                        <input type="text" class="form-control" id="event_title" placeholder="event title name">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Event time</label>
                    <div class="col-sm-6">
                        <input type="text" readonly="readonly" name="event_time" class="form-control"
                               placeholder="event time"
                               id="event_time">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">Textarea</label>
                    <div class="col-sm-6">
                        <textarea class="form-control" id="event_content"></textarea>
                    </div>
                </div>
                <input type="button" class="btn btn-default" value="Confirm" id="confirm_create_event">
            </form>
        </div>
    </div>
</div>

<script>

    $("#confirm_create_event").click(function () {
        var event_title = $("#event_title").val();
        var event_time = $("#event_time").val();
        var event_content = $("#event_content").val();
        var data = {
            "event_title": event_title,
            "event_time": event_time,
            "event_content": event_content,
            "csrfmiddlewaretoken": $("[name='csrfmiddlewaretoken']").val()
        };
        $.ajax({
            type: "POST",
            data: data,
            url: "{{ request.session.base_url }}save_event/",
            cache: false,
            headers: {"X-CSRFToken": $("[name='csrfmiddlewaretoken']").val()},
            dataType: "json",
            success: function (ret) {
                if (ret.status == 0) {
                    query_event();
                } else {
                    alert("There are some problems with the system")
                }
            },
            error: function (e) {
                alert(e.toString());
            }
        });
    });

    var query_event = function () {
        $.ajax({
            type: "POST",
            url: "{{ request.session.base_url }}query_events/",
            cache: false,
            headers: {"X-CSRFToken": $("[name='csrfmiddlewaretoken']").val()},
            dataType: "json",
            success: function (ret) {
                $("#event_table").empty();
                $("#event_table").append(ret.html_text);
            },
            error: function (e) {
                console.log(e.toString());
                alert(e.toString());
            }
        });
    };

    var ini_time = function () {
        var date = new Date();
        var nowMonth = date.getMonth() + 1;
        var strDate = date.getDate();
        var seperator = "-";
        if (nowMonth >= 1 && nowMonth <= 9) {
            nowMonth = "0" + nowMonth;
        }
        if (strDate >= 0 && strDate <= 9) {
            strDate = "0" + strDate;
        }
        var nowDate = date.getFullYear() + seperator + nowMonth + seperator + strDate;
        $("#event_time").val(nowDate);
    }

    $(document).ready(query_event);
    $(document).ready(ini_time);
    $(function () {
        $('input[name="event_time"]').daterangepicker({
            singleDatePicker: true,
            showDropdowns: false,
            minYear: 2015,
            format: 'YYYY-MM-DD',
        }, function (start, end, label) {

        });
    });
    $(document).ready(function () {
        $('#popover-left,#popover-top,#popover-bottom,#popover-right').popover();
        $('#tooltip-left,#tooltip-top,#tooltip-bottom,#tooltip-right').tooltip()
    });
</script>

</html>
